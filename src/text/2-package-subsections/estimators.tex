\subsection{gammapy.estimators}
\label{ssec:gammapy-estimators}
\todo{Axel Donath}
By fitting parametric models to the data, the total integrated
flux and overall temporal, spectral and morphological shape of the
\gammaray emission can be constrained. In many cases it useful
to make a more detailed follow-up analysis by measuring the
flux in smaller spectral, temporal or spatial bins. This
possibly reveals more detailed emission features, which
are relevant for studying correlation with counterpart emissions.

The \verb|gammapy.estimators| sub-module features methods to compute flux
points, light curves, flux maps, flux profiles from data.
The basic method for all these measurements is equivalent.
The initial fine bins of \verb|MapDataset| are grouped into
larger bins. The norm of the best fit "reference" spectral
model is fitted ("scaled") in the  restricted data range only.

The base class of all algorithms is the `Estimator`  class.

Signifiance is estimated based on hypothesis \
testing agains the background only model. This allows
to assign a significance to the given flux bin.
In addition to the best fit flux norm all estimators compute
quantities corresponding to this flux. This includes
the predicted number of total, signal and background
counts per flux bin. The total fit statistics
of the best fit model, the fit statistics of the
null hypothesis and the difference between both.
From the difference in test statistics the significance
of the flux can be derived.

Optionally it can also compute more advanced qunatities
such as assymmetric flux errors, flux upper limits
and one dimensional profiles of the fit statistic,
which show how the likelihood surface varies with
the flux norm parameter around the fit minimum.
This information is useful  for inspecting the quality
of the fit, where for  sane fir a parabolic
shape of the profile is expected (see modeling / fitting section).

The result of the flux point estimation are either stored in a
\verb|FluxMaps| or \verb|FluxPoints| object. Both objects
are based on an internal representation of the flux which is
independent of the SED type. The flux is represented by a
the reference spectral model and an array of
normalisation values given in energy, time and spatial bins,
which factorise the deviation of the flux in the given
bin form the reference spectral model. This allows
user to conveniently transform between different
SED types. See Table \ref{tab:sed_types}.
The actual flux values are obtained by mutiplication of the norm with the
reference flux.

\begin{table*}
    \begin{center}
        \begin{tabular}{lll}
         \hline
         Type & Description & Unit Equivalency \\
         \hline
         dnde & Differential flux at a given energy & $\mathrm{TeV^{-1}~cm^{2}~s^{-1}}$ \\
         e2dnde & Differential flux at a given energy  & $\mathrm{TeV~cm^{2}~s^{-1}}$ \\
         flux & Integrated flux in agiven energy range & $\mathrm{cm^{2}~s^{-1}}$ \\
         eflux & Integrated energy flux in agiven energy range & $\mathrm{erg~cm^{2}~s^{-1}}$
        \end{tabular}
    \end{center}
    \label{tab:sed_types}
    \caption{Definition of sed types.}
\end{table*}


Both result objects support the possibility to serialise
the data into multiple formats. This includes the
GADF SED (reference?) format, FITS based ND sky-maps
and formats compatible with Astropy's \verb|Table| and
\verb|BinnedTimeSeries| data structures. This allows
users to directly further analyse the results, e.g.
standard algorithms for time analysis such as
computing Lomb-Scargle periodograms or Bayesian
blocks for time series.

So far \gammapy does not support "unfolding" of \gammaray spectra.
Methods for this will be implement in future version of \gammapy.

\begin{itemize}
	\item Regrouping of dataset bins in time, energy etc.
	\item "Forward folding" / "Backward folding": but there is no
	      difference between the two, backwards folding is forward folding with one bin
	\item Likelihood profiles \item Uniform N-dimensional data structure \item
	      Uniform API for plotting etc. \item \verb|FluxMaps| and \verb|FluxPoints| \item
	      Serialisation to multiple formats, Astropy's \verb|Table| and
	      \verb|BinnedTimeSeries|
	\item Additional quantities for debugging, such as predicted counts, fit convergence,
	      sum of fit statistics \item \end{itemize}

Code example ~\ref{fig*:minted:gp_estimators} shows how to use
the \verb|TSMapEstimator| with a given input `MapDataset`.
In addition to the model it allows to specify the energy
bisn of the resulting flux and TS maps.

\begin{figure}
	\import{code-examples/generated/}{gp_estimators}
	\caption{Using the TSMapEstimator from gammapy.estimators to compute a
		sqrt(TS) map.} \label{fig*:minted:gp_estimators} \end{figure}
